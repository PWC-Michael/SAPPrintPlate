<!DOCTYPE html>
<html lang="en">
<head>
    <title>Plate Printing</title>
    <link href="main.css" rel="stylesheet"/>
</head>
<body class="printer">
    <div id="marque"></div>
    <div id="platePrintArea-printer">
        <div class="reg-letters" id="plateRender">
            <span id="actual-letters"></span>
        </div>
        <div class="slogan" id="sloganMessage" style="font-family: Arial, Helvetica, sans-serif; font-weight: bold;"></div>
        <div class="slogan" id="sloganPostcode"></div>
        <div class="slogan" id="bsau"></div>
    </div>

    <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
    <script>if (window.module) module = window.module;</script>

    <script>
        
        const ipcRenderer = require("electron").ipcRenderer;
        const render = function(content) {
            return new Promise(function(resolve, reject) {
                const platePrinterAreaParent = document.getElementById('platePrintArea-printer');
                const platePrinterArea = document.getElementById('plateRender');
                const plateSloganMessage = document.getElementById('sloganMessage');
                const plateSloganPostcode = document.getElementById('sloganPostcode');
                const plateBSAU = document.getElementById('bsau');
                const plateActualLetters = document.getElementById('actual-letters');
                const plateMarque = document.getElementById('marque');

                const PLATE_HEIGHT = content.plateHeight;
                const PLATE_WIDTH = content.plateWidth;
                const EU_LOGO_WIDTH = 45;


                plateActualLetters.innerHTML = content.plateText;
                plateSloganMessage.innerHTML = content.sloganMessage;
                plateSloganMessage.style.fontSize = content.sloganMessageFontSize + "mm";
                plateSloganPostcode.innerHTML = content.postCode;
                plateBSAU.innerHTML = content.plateBSAU;
                plateSloganMessage.style.marginTop = content.sloganMessageRaise + "mm";

                //platePrinterAreaParent.style.width = "100%"
                //platePrinterAreaParent.style.height ="100%";
                //platePrinterAreaParent.style.borderWidth = '1mm';
                //platePrinterAreaParent.style.borderColor = '#000000';
                //platePrinterAreaParent.style.borderStyle = 'solid';
                
                //platePrinterArea.style.display = 'flex';
                //platePrinterArea.style.alignItems = 'center';
                //platePrinterArea.style.justifyContent = 'center';
                //platePrinterArea.style.marginTop = "-" + content.plateRaise + "mm";

                //console.log(content.printBorder);
                

                // let do the setup options
                //if (content.mirror) {
                //    $('#platePrintArea-printer').addClass('mirror-text');
                //}
                
                if (content.printBorder == '1') {
                    let borderMargin = content.printBorderMargin;
                    let borderWidth = content.printBorderWidth;
                    let borderMarginCSSVal = "0mm";
                    let borderWidthCSSVal = "0mm";
                    let platePrintAreaWidth = 0;
                    let platePrintAreaHeight = 0;
                    if (borderWidth > 0) {
                        borderWidthCSSVal = borderWidth.toString() + 'mm'; 
                    }
                    if (borderMargin > 0) {
                        borderMarginCSSVal = borderMargin.toString() + 'mm'; 
                        platePrintAreaWidth = PLATE_WIDTH - (borderMargin * 2) - 4;
                        platePrintAreaHeight = PLATE_HEIGHT - (borderMargin * 2) - 4;
                    }
                    platePrinterAreaParent.style.borderWidth = borderWidthCSSVal;
                    platePrinterAreaParent.style.borderColor = '#000000';
                    platePrinterAreaParent.style.borderStyle = 'solid';
                    platePrinterAreaParent.style.borderRadius = '30px';
                    platePrinterAreaParent.style.width = platePrintAreaWidth + "mm";
                    platePrinterAreaParent.style.height = platePrintAreaHeight + 'mm';
                    platePrinterAreaParent.style.padding = borderMarginCSSVal;
                    platePrinterArea.style.marginTop = "1mm";
                    platePrinterArea.style.marginLeft = '-10mm';

                }
                else {
                    let plateRaiseVal = 0;
                    if (content.plateRaise < 0) {
                        plateRaiseVal = content.plateRaise - 6 + "mm";
                    }
                    else {

                    }
                    platePrinterArea.style.marginTop = "1mm";
                    platePrinterArea.style.marginLeft = '-6mm';
                }
                if (content.printMarque == '1') {
                    let marqueDisplayVal = "block";
                    let marqueFloatVal = "right";
                    let marqueBlockWidth = 0;
                    let marqueBlockWidthCSS = '';

                    displayVal = "block";
                    floatVal = "right";
                    marqueBlockWidth = PLATE_WIDTH - EU_LOGO_WIDTH;
                    if (content.printBorder) {
                        let reduceBy = (parseInt(content.printBorderMargin) * 2) - parseInt(content.printBorderWidth);
                        marqueBlockWidth -= reduceBy;
                    }
                    marqueBlockWidthCSS = marqueBlockWidth.toString() + "mm";
                    
                    //platePrinterArea.style.float = marqueFloatVal;
                    platePrinterArea.style.marginLeft = '43mm';
                    platePrinterArea.style.width = marqueBlockWidthCSS;
                    plateMarque.style.display = marqueDisplayVal;
                }
                
                resolve();
            });
        };
        
        ipcRenderer.on("preparePrint", function(event, content) { 
            render(content).then(function() {
                setTimeout(function() {
                    ipcRenderer.send("printRenderedHandler");
                }, 1000);
            });
        });

        ipcRenderer.on("printPlate", function(event, content) {
            ipcRenderer.send("sendPlateToPrinterHandler");
        });

    </script>
</body>
</html>